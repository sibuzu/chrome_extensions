{"version":3,"file":"login.js","mappings":"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","sources":["webpack://youtube-subtitles-extension/./login.js"],"sourcesContent":["// Store window ID when page loads\nlet currentWindowId = null;\nchrome.windows.getCurrent((window) => {\n  currentWindowId = window.id;\n  console.log('Current window ID:', currentWindowId);\n});\n\nconst CLIENT_ID = '97560438297-fmm1llujqijpeveridcb8ovhf96j1j4p.apps.googleusercontent.com';\nconst REDIRECT_URI = chrome.identity.getRedirectURL();\nconst SCOPES = ['openid', 'email', 'profile'];\n\n// Log the redirect URI\nconsole.log('Redirect URI:', REDIRECT_URI);\n\nconsole.log('Login page initialized');\n\n// Listen for messages\nchrome.runtime.onMessage.addListener((request) => {\n  if (request.action === 'login') {\n    // Handle login\n    chrome.identity.getAuthToken({ interactive: true }, (token) => {\n      if (chrome.runtime.lastError) {\n        console.error(chrome.runtime.lastError);\n        return;\n      }\n\n      if (token) {\n        chrome.storage.local.set({ token }, () => {\n          console.log('Token saved');\n        });\n      }\n    });\n  }\n\n  if (request.action === 'logout') {\n    // Handle logout\n    chrome.storage.local.remove('token', () => {\n      console.log('Token removed');\n    });\n  }\n});\n\ndocument.getElementById('googleLogin').addEventListener('click', async () => {\n  const button = document.getElementById('googleLogin');\n  const container = document.querySelector('.login-container');\n  button.disabled = true;\n\n  try {\n    console.log('Starting authentication process...');\n    const result = await authenticate();\n    console.log('Authentication result:', result);\n\n    if (result && result.token) {\n      console.log('Got token, storing in chrome.storage.local...');\n\n      // Store both token and user info\n      await chrome.storage.local.set({\n        authToken: result.token,\n        userInfo: result.user,\n      });\n\n      // Verify storage\n      const stored = await chrome.storage.local.get(['authToken', 'userInfo']);\n      console.log('Stored data:', stored);\n\n      // Update UI to show success\n      container.innerHTML = `\n        <img src=\"icons/icon128.png\" alt=\"DeepSRT Logo\" class=\"logo\">\n        <h2>Login Successful!</h2>\n        <p>Welcome ${result.user.email}</p>\n        <div class=\"success-checkmark\">âœ“</div>\n      `;\n\n      // Add success styles\n      const style = document.createElement('style');\n      style.textContent = `\n        .success-checkmark {\n          font-size: 48px;\n          color: #34D399;\n          margin-top: 20px;\n          animation: popIn 0.5s ease-out;\n        }\n        @keyframes popIn {\n          0% { transform: scale(0); }\n          70% { transform: scale(1.2); }\n          100% { transform: scale(1); }\n        }\n      `;\n      document.head.appendChild(style);\n\n      // Send success message\n      chrome.runtime.sendMessage({\n        type: 'LOGIN_SUCCESS',\n        token: result.token,\n        user: result.user,\n      });\n\n      // Wait for animation and close\n      setTimeout(() => {\n        console.log('Attempting to close window...');\n        window.close();\n\n        // Fallback: try getting the current tab\n        chrome.tabs.getCurrent((tab) => {\n          if (tab) {\n            console.log('Found current tab, attempting to close via tabs API...');\n            chrome.tabs.remove(tab.id);\n          }\n        });\n      }, 1000);\n    } else {\n      throw new Error('No token received from authentication');\n    }\n  } catch (error) {\n    console.error('Login failed:', error);\n    button.disabled = false;\n    container.innerHTML += `\n      <p style=\"color: #EF4444; margin-top: 10px;\">\n        Authentication failed. Please try again.\n      </p>\n    `;\n  }\n});\n\nasync function authenticate() {\n  console.log('Building auth URL...');\n  const authUrl = new URL('https://accounts.google.com/o/oauth2/v2/auth');\n  authUrl.searchParams.append('client_id', CLIENT_ID);\n  authUrl.searchParams.append('response_type', 'token');\n  authUrl.searchParams.append('redirect_uri', REDIRECT_URI);\n  authUrl.searchParams.append('scope', SCOPES.join(' '));\n\n  console.log('Starting web auth flow...');\n  try {\n    const responseUrl = await chrome.identity.launchWebAuthFlow({\n      url: authUrl.toString(),\n      interactive: true,\n    });\n\n    console.log('Got response URL:', responseUrl);\n\n    if (responseUrl) {\n      const url = new URL(responseUrl);\n      const params = new URLSearchParams(url.hash.substring(1));\n      const token = params.get('access_token');\n\n      if (token) {\n        console.log('Token extracted, verifying...');\n        const userInfo = await verifyToken(token);\n        console.log('User info received:', userInfo);\n        return {\n          token,\n          user: userInfo,\n        };\n      }\n    }\n    throw new Error('No token received');\n  } catch (error) {\n    console.error('Auth flow failed:', error);\n    throw error;\n  }\n}\n\nasync function verifyToken(token) {\n  try {\n    const response = await fetch('https://www.googleapis.com/oauth2/v3/userinfo', {\n      headers: {\n        Authorization: `Bearer ${token}`,\n      },\n    });\n\n    if (!response.ok) {\n      throw new Error('Failed to verify token');\n    }\n\n    return await response.json();\n  } catch (error) {\n    console.error('Token verification failed:', error);\n    throw error;\n  }\n}\n"],"names":["currentWindowId","chrome","windows","getCurrent","window","id","console","log","CLIENT_ID","REDIRECT_URI","identity","getRedirectURL","SCOPES","runtime","onMessage","addListener","request","action","getAuthToken","interactive","token","lastError","error","storage","local","set","remove","document","getElementById","addEventListener","button","container","querySelector","disabled","result","authenticate","authToken","userInfo","user","stored","get","innerHTML","email","style","createElement","textContent","head","appendChild","sendMessage","type","setTimeout","close","tabs","tab","Error","authUrl","URL","searchParams","append","join","responseUrl","launchWebAuthFlow","url","toString","params","URLSearchParams","hash","substring","verifyToken","response","fetch","headers","Authorization","ok","json"],"sourceRoot":""}